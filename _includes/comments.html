<div
  id="comments"
  class="comments {% if include.top-separator %}comment-separator{% endif %}"
>
  {% if include.top == nil or include.top %}
    <div class="top">
     <span class="title">Comments:</span>
     <a class=action href="{{ page.id }}/comments.xml">feed</a>
     <input type="checkbox" id="reply-" class="reply-input">
     {% include comment-form.html post=page.id id="" reply=false %}
    </div>
  {% endif %}
  <div class="content">
    {% if comments.size > 0 %}
      {% assign ids = comments | map: "id" %}
      {% for comment in comments %}

        {% assign padding = comment.ancestors | where_exp: "ancestor", "ids contains ancestor" | size | times: 2 %}
        {% if include.flatten %}
          {% assign padding = 0 %}
        {% endif %}

        {% if include.post and padding  == 0 %}
        <div>On <a class="action" href="{{comment.post}}">{{site.data.post_id_map[comment.post]["title"]}}</a></div>
        {% endif %}

        <input
          type="checkbox"
          id="toggle-{{ comment.id }}"
          class="toggle-input comment-{{ comment.id }}"
          style="padding-left: {{ padding }}em">
        <label
          for="toggle-{{comment.id}}"
          class="toggle-label comment-{{ comment.id}}"
          style="padding-left: {{ padding }}em"></label>
        <div
          id="comment-{{comment.id}}"
          class="comment comment-{{ comment.id }}"
          style="padding-left: {{ padding }}em">
          <span class="info">
            <a
              class="action"
              {% if comment.name == "ckardaris" %}
                style="font-weight: bold"
              {% endif %}
              href="/blog/user/{{ comment.name }}/comments"
            >{{ comment.name }}</a>
            | <time><a class="action" href="/blog/comment/{{comment.id}}/thread">{{ comment.date }} CET</a></time>
            | <a class="action" href="/blog/comment/{{ comment.id }}/thread.xml">feed</a>
            {% if include.context %}
              | <a class="action" href="{{comment.post}}#comment-{{comment.id }}">context</a></time>
            {% endif %}
            {% assign root = comment.ancestors | first %}
            {% assign parent = comment.ancestors | last %}
            {% if ids contains root and root != parent %}
              | <a class="action" href="#comment-{{ root }}">root</a>
            {% endif %}
            {% if ids contains parent %}
              | <a class="action" href="#comment-{{ parent }}">parent</a>
            {% endif %}
            {% if comment.prev %}
              | <a class="action" href="#comment-{{comment.prev}}">prev</a>
            {% endif %}
            {% if comment.next %}
              | <a class="action" href="#comment-{{comment.next}}">next</a>
            {% endif %}
          </span>

          <div class="body">
            {% comment %}
                I put the <input> before the <div> so that I can style the div when <input> is checked.
            {% endcomment %}
            <input type="checkbox" id="reply-{{comment.id}}" class="reply-input">
            <div class="markdown">{{ comment.comment | markdownify }}</div>
            {% include comment-form.html post=comment.post id=comment.id reply=true %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      No comments to show.
    {% endif %}
  </div>
</div>

{% include script.html script="load.js" %}
{% include script.html script="openpgp.js" %}
{% include script.html script="preview.js" %}
{% include script.html script="send-comment.js" %}
{% include script.html script="eye.js" %}
{% include style.html style="toggle-comments.css" %}
