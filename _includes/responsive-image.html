<div class="responsive-image {{include.div_class}}" style="text-align: center">
  {% comment %}
    The original image is used as 'href' by default.
    If we want to follow some other link we need to explicitly pass it.
  {% endcomment %}
  {% if include.href %}
    {% assign href = include.href %}
  {% else %}
    {% assign href = "/assets" | append: include.path %}
  {% endif %}
  <a href="{{ href }}" aria-label="Open photo: {{ include.alt }}">
    <picture {% if include.img_class %} class="{{include.img_class}}" {% endif %} >
      <source type="image/avif"
        {% assign include_file = "responsive" | append: include.path | append: "/srcset" %}
        {% capture srcset %} {%- include {{ include_file }} -%} {% endcapture %}
        srcset="{{ srcset }}"

        {% if include.grid -%}
          {% comment %}
          We need adjust the 'sizes' according to the available space.
          The current margin left and right is 30px.
          And the current gap in the photo grid is 10px.

                                            2 * margin                          2 * margin - grid gap
          {% endcomment %}
          sizes="(max-width: 549px) calc(100vw - 2 * 30px), (max-width: 799px) calc((100vw - 2 * 30px - 10px) * 0.5), 240px"
        {%- else -%}
          sizes="min(calc(100vw - 60px), 800px)"
        {%- endif %}
      >

      <img
        src="/assets{{ include.path }}"
        alt="{{ include.alt }}"
        {% if include.loading %} loading="{{ include.loading }}" {% endif %}
      >
    </picture>
  </a>

  {% if include.caption %}
    <div class="photo-caption" style="text-align: center;">
      <p><em>{{include.caption}}</em></p>
    </div>
  {% endif %}
</div>
